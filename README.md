# youdeploy-cli
Source code of Cycloid command line to use yd API


For test purpose we stored several version of the CLI in CLIs directory.
/!\ the gen script actually rsync them one of top of the others. The prod behavior expect to only do some git tags. But all source code will end up at the same place under cmd/cycloid.

As well as client (the api client generated from swagger) is generated by swagger-files. Prod version expect as well this to be in the directory using git tags


# Gen cli plugins

```
for i in $(seq 1 3); do
./gen.sh $i
done
```

# Run fake api server

```
docker run -it -p 80:5000 gaell/simple-docker-app
```

# Build and run cli using plugin version 1

```
make build &&  V=1 ./cy external-backends list
```

# Usecases

V=1 mean we are connecting to Cycloid api v1. So we load v1 plugin
This should be done later by a curl on /version I think

## Usecase 1 url typo change

```
v1 '/organizations/{organization_canonical}/external_backend'
    flag pproject
>
v2 '/organizations/{organization_canonical}/external_backends'
    flag pproject
>
v3 '/organizations/{organization_canonical}/external_backends'
    flag project
```

Expected
```
make build &&  V=1 ./cy external-backends list --pproject foo
# > "GET /organizations/cycloid/external_backend?environment=website&pproject=prod

V=2 ./cy external-backends list --pproject foo
# > "GET /organizations/cycloid/external_backends?environment=website&pproject=prod

V=3 ./cy external-backends list --pproject foo
V=3 ./cy external-backends list --project foo
# > "GET /organizations/cycloid/external_backends?environment=website&project=prod
```
